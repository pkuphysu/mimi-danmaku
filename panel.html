<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mimi Danmaku Panel</title>
<link href="cdn/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<script src="cdn/jquery-3.2.1.min.js"></script>
<script>if (typeof module === "object") {window.jQuery = window.$ = module.exports;};</script>
</head>
<body>
<div class="container" style="margin: 0 20px 20px 20px;">
	<div class="row">
		<h1>Mimi Danmaku</h1>
		<p id="help">欢迎使用米米弹幕</p>
	</div>

	<div class="row">
		<div class="form-group">
		显示模式
			<div class="btn-group" role="group">
				<button type="button" class="btn btn-default active">固定(全屏幕)</button>
				<button type="button" class="btn btn-default">窗口(可移动)</button>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="form-group">
		窗口叠放
			<div class="btn-group" role="group">
				<button type="button" class="btn btn-default active">绝对置顶</button>
				<button type="button" class="btn btn-default">始终置顶</button>
			</div>
		</div>
	</div>

	<div class="row" style="display: none;">
		<div class="form-group">
		背景图片
			<div class="btn-group" role="group">
				<button type="button" class="btn btn-default active">透明背景</button>
				<button type="button" class="btn btn-default">默认图片</button>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="form-group">
		弹幕过滤
			<div class="btn-group" role="group">
				<button type="button" class="btn btn-default active">默认允许</button>
				<button type="button" class="btn btn-default">默认禁止</button>
				<button type="button" class="btn btn-default">自动过滤</button>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="form-group">
		过滤规则<span class="text-muted">（屏蔽词，使用空格分隔）</span>
			<textarea class="form-control" rows="3" id="rule"></textarea>
		</div>
	</div>
	
	<div class="row">
		<div class="form-group">
		弹幕频道
			<input type="text" class="form-control" placeholder="default" id="channel"/>
		</div>
	</div>

	<div class="row">
		<button class="btn btn-success" onclick="wsreload()">连接弹幕频道</button>
		<button class="btn btn-primary" onclick="panelSubmit()" id="submit">开启弹幕窗口</button>
		<button class="btn btn-default" onclick="about()">关于</button>
	</div>
	<div class="row" style="margin-top: 10px;">
		<button class="btn btn-primary" onclick="clearAll()">清空弹幕列表</button>
		<button class="btn btn-danger" onclick="denyAll()" id="submit">清除所有弹幕</button>
		<table class="table table-striped" style="table-layout: fixed; margin-top: 10px;">
			<thead>
				<tr>
					<th>弹幕内容</th>
					<th style="width: 140px;">审核</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>欢迎使用米米弹幕</td>
					<td>
						<div class="btn-group" role="group">
							<button type="button" class="btn btn-success disabled">已通过</button>
							<button type="button" class="btn btn-danger disabled">禁止</button>
						</div>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>

<script>
const electron = require("electron").remote;
const ipcRenderer = require("electron").ipcRenderer;
const BrowserWindow = electron.BrowserWindow;
const fs = require("fs");
var server = "wss://localhost:9005",
	rule = "",
	channel = "default";

fs.readFile("config.json", function(err, data) {
	if (err) throw err;
	var result = JSON.parse(data.toString());
	server = result.server || server;
	rule = result.rule || rule;
	channel = result.channel || channel;
	$("#rule").val(rule);
	$("#channel").val(channel);
});

var mainWindow = null,
	currentChannel = "default",
	outputArray = new Array(),
	allowArray = new Array(),
	denyArray = new Array();

var helpArray = [
	["弹幕窗口将在全屏幕上浮动显示", "弹幕窗口将以窗口形式显示"],
	["窗口将始终处于屏幕顶层，即使存在其他全屏应用", "使用其他全屏应用时，弹幕窗口可能不会置顶"],
	["弹幕窗口背景透明", "弹幕窗口使用系统预设背景"],
	["默认允许所有弹幕", "默认禁止所有弹幕", "弹幕按照规则自动过滤"]
];
var options = [0, 0, 0, 0];

function getChannel() {
	var reg = new RegExp(/[\x00-\xff]+/g);
	var channel =  $("#channel").val() || "default";
	if (!reg.test(channel)) channel = "default";
	return channel;
}

window.addEventListener("beforeunload", e => {
	if (mainWindow) {
		e.returnValue = false;
		alert("弹幕窗口开启时无法退出控制面板");
	}
});
</script>
<script src="js/base.js"></script>
<script src="js/settings.js"></script>
<script src="js/mainwindow.js"></script>
<script src="js/wsconnect.js"></script>
<script src="js/harmony.js"></script>
</body>
</html>
